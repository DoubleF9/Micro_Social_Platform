@using System.Security.Claims

@{
    ViewBag.Title = "Conversations";
    var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<div class="container py-5">
    <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header bg-transparent border-0 pt-4 px-4">
            <h2 class="d-flex align-items-center gap-2 m-0">
                <i class="bi bi-chat-dots"></i>
                Conversations
            </h2>
        </div>

        <div class="card-body p-4">
            <h3>Direct Messages</h3>
            <ul class="list-group mb-4">
                @if (ViewBag.DirectMessages != null)
                {
                    @foreach (var message in ViewBag.DirectMessages)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                <!--Daca imi trimit singur mesaj-->
                                @if (message.SenderId == currentUserId && message.ReceiverId == currentUserId)
                                {
                                    <i class="bi bi-arrow-right"></i>
                                    <span>@message.Receiver</span>
                                }
                                 

                                @if (message.SenderId == currentUserId)
                                {
                                    <i class="bi bi-arrow-right"></i>
                                    <span>@message.Receiver</span>
                                    
                                }
                                else
                                {
                                    <i class="bi bi-arrow-left"></i>
                                    <span>@message.Sender</span>
                                }
                            </span>
                            <a href="@Url.Action("DirectMessages", "Messages", new { userId = message.SenderId == currentUserId ? message.ReceiverId : message.SenderId })" class="btn btn-primary btn-sm">View Messages</a>
                        </li>
                    }
                }
                else
                {
                    <li class="list-group-item">No direct messages available.</li>
                }
            </ul>

            <h3>Group Messages</h3>
            <ul class="list-group">
                @if (ViewBag.GroupMessages != null)
                {
                    @foreach (var group in ViewBag.GroupMessages)
                    {
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>@group.Name</span>
                            <a href="@Url.Action("GroupMessages", "Messages", new { groupId = group.Id })" class="btn btn-primary btn-sm">View Messages</a>
                        </li>
                    }
                }
                else
                {
                    <li class="list-group-item">No group messages available.</li>
                }
            </ul>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}


